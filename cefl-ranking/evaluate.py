import pandas as pd
import numpy as np

data_mnist = {
    "Method": ["FedAvg", "DGC", "signSGD", "STC", "SCA", "QSGD", "LQ", "FedResCue", "Fedsynth", "3sfc"],
    "dataset": ["MNIST"] * 10,
    "初始准确率": [0.0953] * 10,
    "最高准确率": [0.9814, 0.9769, 0.9855, 0.9688, 0.9720, 0.9804, 0.9191, 0.9716, 0.13, 0.9621],
    "总训练时间(s)": [4979.1, 4993.01, 5472.37, 5474.58, 4755.23, 5598.56, 12476.77, 4738, 23494.41, 6709.12],
    "总通信量(MB)": [30457.214, 15342.826, 19035.758, 60.913, 15228.607, 19035.832, 23794.698, 30042.664, 15304.76, 15225.183],
    "总计算量(FLOPs)": [
        2619569817845760,
        2619581794109760,
        2619573809933760,
        3288050579364000,
        654905229138240,
        2619601756469760,
        3309717896537280,
        2709346418688000,
        330702216150159360,
        3274279367823360
    ]
}

data_mnist10 = {
    "Method": ["FedAvg", "DGC", "signSGD", "STC", "SCA", "QSGD", "LQ", "FedResCue", "Fedsynth", "3sfc"],
    "dataset": ["MNIST"] * 10,
    "初始准确率": [0.0953] * 10,
    "最高准确率": [0.976, 0.9533, 0.9804, 0.9615, 0.9673, 0.9737, 0.9186, 0.9555, 0.1205, 0.963],
    "总训练时间(s)": [3313.36, 3380.13, 3683.81, 3979.91, 3291.19, 3587.44, 14025.72, 9806.74, 16891.8, 4622.23],
    "总通信量(MB)": [15228.6027, 7671.413, 9517.879, 36.5478, 7614.3036, 9517.916, 14873.94, 14959.245, 7837.59, 7612.59],
    "总计算量(FLOPs)": [
        1866569758310400,
        1866575746442400,
        1866571754354400,
        2397970871888160,
        466648826916000,
        1866585727622400,
        3743736251000000,
        1866569758310400,
        238760636884224000,
        2363966701824000
    ]
}

data_mnist40 = {
    "Method": ["FedAvg", "DGC", "signSGD", "STC", "SCA", "QSGD", "LQ", "FedResCue", "Fedsynth", "3sfc"],
    "dataset": ["MNIST"] * 10,
    "初始准确率": [0.0953] * 10,
    "最高准确率": [0.9799, 0.9808, 0.9846, 0.9562, 0.9637, 0.9777, 0.8795, 0.8679, 0.1304, 0.9543],
    "总训练时间(s)": [5430.65, 5232.19, 5706.71, 5414.39, 5319.33, 6509.94, 11069.20, 5271.43, 23118.76, 9608.75],
    "总通信量(MB)": [60914.428, 30685.652, 38071.517, 98.58, 30457.214, 38071.664, 47589.39, 59656.7618, 30742.83, 30450.36],
    "总计算量(FLOPs)": [
        2648645730631680,
        2648669683159680,
        2648653714807680,
        3312657357551520,
        662186982011520,
        2648709607879680,
        3443239449821180,
        2731890254924417,
        332843337339002900,
        3295478587514880
    ]
}



data_fmnist = {
    "Method": ["FedAvg", "DGC", "signSGD", "STC", "SCA", "QSGD", "LQ", "FedResCue", "Fedsynth", "3sfc"],
    "dataset": ["FMNIST"] * 10,
    "初始准确率": [0.1] * 10,
    "最高准确率": [0.8607, 0.8492, 0.8772, 0.8427, 0.8412, 0.8623, 0.6920, 0.7679, 0.1238, 0.7721],
    "总训练时间(s)": [4844.12, 4966.77, 5453.55, 5560.8, 5023.85, 5724.83, 12513.48, 8880.4, 22842.60, 6795.55],
    "总通信量(MB)": [30457.214, 15342.826, 19035.758, 73.393, 15228.607, 19035.832, 23794.698, 20007.455, 15304.76, 15225.183],
    "总计算量(FLOPs)": [
        2660115611811840,
        2660127588075840,
        2660119603899840,
        3340538266081440,
        665041677629760,
        2660147550435840,
        3311700345136320,
        1806388282982400,
        330702216150159360,
        3330731951738880
    ]
}
data_emnist = {
    "Method": ["FedAvg", "DGC", "signSGD", "STC", "SCA", "QSGD", "LQ", "FedResCue", "Fedsynth", "3sfc"],
    "dataset": ["EMNIST"] * 10,
    "初始准确率": [0.0204] * 10,
    "最高准确率": [0.9011, 0.8435, 0.7264, 0.8672, 0.8625, 0.8878, 0.4123, 0.8602, 0.1059, 0.6322],
    "总训练时间(s)": [9804.32, 9542.63, 9504.89, 12030.69, 9591.72, 10009.25, 7755.76, 8790.432, 38375.57, 11443.53],
    "总通信量(MB)": [30607.507, 15418.535, 19129.692, 61.11, 15303.754, 19129.765, 21520.903, 30414.367, 15464.76, 15315.183],
    "总计算量(FLOPs)": [
        5595647827968000,
        5597248317723492,
        5595651839755200,
        7005748361345400,
        1398924794702400,
        5595679924185600,
        2787500030366400,
        3780970782720000,
        701781224913459200,
        6948324959539200
    ]
}

data_cifar10 = {
    "Method": ["FedAvg", "DGC", "signSGD", "STC", "SCA", "QSGD", "LQ", "FedResCue", "Fedsynth", "3sfc"],
    "dataset": ["CIFAR10+CNN"] * 10,
    "初始准确率": [0.0991] * 10,
    "最高准确率": [0.6433, 0.5927, 0.6007, 0.5536, 0.61, 0.6161, 0.2456, 0.4662, 0.1037, 0.5103],
    "总训练时间(s)": [5103.73, 4726.27, 5228.45, 5669.98, 5243.33, 5736.34, 9364.24, 11505.63, 28144, 8392.63],
    "总通信量(MB)": [39486.511, 19891.33, 24679.069, 78.275, 19743.256, 24679.142, 27763.953, 25938.83, 19584.361, 19250.571],
    "总计算量(FLOPs)": [
        3263913740206080,
        3263957348294086,
        3263918915782080,
        4068706050123600,
        3263930302044480,
        3263955146734080,
        4015175113448640,
        2209140517109760,
        409297909772943360,
        4052454552207360
    ]
}



data_cifar10_res = {
    "Method": ["FedAvg", "DGC", "signSGD", "STC", "SCA", "QSGD", "LQ", "FedResCue", "Fedsynth", "3sfc"],
    "dataset": ["CIFAR10+Res"] * 10,
    "初始准确率": [0.1001] * 10,
    "最高准确率": [0.7173, 0.6441, 0.4371, 0.605, 0.7361, 0.7981, 0.2437, 0.2468, 0.1185, 0.61],
    "总训练时间(s)": [11707.43, 14292, 15154.63, 16245.22, 16214.56, 17702.57, 36329.00, 14561.35, 106094.09, 31637.86],
    "总通信量(MB)": [204601.354, 103323.687, 127875.85, 351.576, 102300.677, 127876.414, 143798.529, 201729.857, 101968.572, 101877.403],
    "总计算量(FLOPs)": [
        61481615983902720,
        60191125091000640,
        61486615433205773,
        61425410076279600,
        60695329869428160,
        60695458608495360,
        196541800456824000,
        104852098134835200,
        12729028875264000000,
        126029988864000000
    ]
}


data_cifar100 = {
    "Method": ["FedAvg", "DGC", "signSGD", "STC", "SCA", "QSGD", "LQ", "FedResCue", "Fedsynth", "3sfc"],
    "dataset": ["CIFAR100+ResNet18"] * 10,
    "初始准确率": [0.0098] * 10,
    "最高准确率": [0.4489, 0.4591, 0.0831, 0.2062, 0.2888, 0.4455, 0.04, 0.0154, 0.01, 0.0826],
    "总训练时间(s)": [11661.76, 14287.67, 15661.42, 9752.69, 13238.24, 14723.57, 47885.79, 15231.96, 107094.09, 32440.39],
    "总通信量(MB)": [205446.752, 103750.616, 128404.22, 354.965, 102723.376, 128404.788, 143798.53, 202096.066, 104998.572, 101949.403],
    "总计算量(FLOPs)": [
        60718836665548800,
        59757147663926400,
        61486615433205773,
        60813642915892200,
        60718922836017600,
        60719052106963200,
        252260191671984000,
        104813840302080000,
        12729028875264000000,
        126029988864000000
    ]
}

data_cifar100Res = {
    "Method": ["FedAvg", "DGC", "signSGD", "STC", "SCA", "QSGD", "LQ", "FedResCue", "Fedsynth", "3sfc"],
    "dataset": ["CIFAR100+ResNet34"] * 10,
    "初始准确率": [0.01] * 10,
    "最高准确率": [0.1066, 0.0848, 0.0115, 0.0567, 0.1428, 0.1723, 0.018, 0.013, 0.0105, 0.0632],
    "总训练时间(s)": [14250.4, 8463.53, 9243.1515, 8899.64, 16143.27, 19617.25, 68351.67, 21742.3, 151002.66, 45740.94],
    "总通信量(MB)": [394320.031, 199131.61, 246450.0196, 707.0411, 195188.415, 243986.196, 274655.19, 384174.42, 200547.27, 195674.51],
    "总计算量(FLOPs)": [float(x) for x in [
        130622865200667920,
        130623020253613380,
        130621050253613360,
        129223289320965408,
        126796586419814976,
        129020392948648704,
        542359412094765600,
        218757057824686080,
        27367412081817600000,
        270964476057600000
    ]]
}

data_mnist_com = {
    "Method": ["FedAvg", "DGC", "signSGD", "STC", "SCA", "QSGD", "LQ", "FedResCue", "Fedsynth", "3sfc"],
    "dataset": ["MNIST"] * 10,
    "初始准确率": [0.0953] * 10,
    "最高准确率": [0.9814, 0.9769, 0.9855, 0.9688, 0.9720, 0.9804, 0.9191, 0.9716, 0.13, 0.9621],
    "总训练时间(s)": [7495.16, 5213.65, 5894.58, 5740.63, 5870.60, 5706.329, 12476.77, 4838, 23794.41, 5706.329],
    "总通信量(MB)": [30457.214, 15342.826, 19035.758, 266.38, 19698.668, 18941.1265, 23794.698, 30042.664, 19087.76, 18941.126],
    "总计算量(FLOPs)": [
        2619569817845760,
        2619581794109760,
        2619573809933760,
        3288050579364000,
        2615305488003820,
        2615328131614567,
        3309717896537280,
        2709346418688000,
        264148141293071267,
        2615328131614567
    ]
}


data_cifar10_com = {
    "Method": ["FedAvg", "DGC", "signSGD", "STC", "SCA", "QSGD", "LQ", "FedResCue", "Fedsynth", "3sfc"],
    "dataset": ["CIFAR10+CNN"] * 10,
    "初始准确率": [0.0991] * 10,
    "最高准确率": [0.6433, 0.5927, 0.6007, 0.5536, 0.61, 0.6161, 0.2456, 0.4662, 0.1037, 0.5103],
    "总训练时间(s)": [7600.0698, 5761.2674, 6169.57, 6727.54, 6446.821, 6805.87, 11049.80, 13576.64, 33209.92, 9903.30],
    "总通信量(MB)": [39290.06, 19792.3711, 24679.069, 78.275, 25538.512, 24556.3609, 27763.953, 25938.83, 19584.361, 19250.571],
    "总计算量(FLOPs)": [
        3287287755424477,
        3263957348294086,
        3263918915782080,
        4068706050123600,
        3287299600019104,
        3287328955949850,
        4015175113448640,
        2209140517109760,
        409297909772943360,
        4052454552207360
    ]
}


data_cifar10_res_com = {
    "Method": ["FedAvg", "DGC", "signSGD", "STC", "SCA", "QSGD", "LQ", "FedResCue", "Fedsynth", "3sfc"],
    "dataset": ["CIFAR10+Res"] * 10,
    "初始准确率": [0.1001] * 10,
    "最高准确率": [0.7173, 0.6441, 0.4371, 0.605, 0.7361, 0.7981, 0.2437, 0.2468, 0.1185, 0.61],
    "总训练时间(s)": [26895.325, 19430.4034, 16454.63, 16017.52, 22206.32, 22253.035, 54493.50, 21113.96, 153836.43, 52545.643],
    "总通信量(MB)": [203495.9844, 102765.4756, 127875.85, 1894.565, 132271.837, 127185.3728, 143798.529, 201729.857, 105968.572, 102028.763],
    "总计算量(FLOPs)": [float(x) for x in[
        103260259379964180,
        103591125091000640,
        103486615433205773,
        127212173135940290,
        103260320726858500,
        103260472770999400,
        196541800456824000,
        104852098134835200,
        22729028875264000000,
        254248926742925340
    ]]
}


data_cifar100_com = {
    "Method": ["FedAvg", "DGC", "signSGD", "STC", "SCA", "QSGD", "LQ", "FedResCue", "Fedsynth", "3sfc"],
    "dataset": ["CIFAR100"] * 10,
    "初始准确率": [0.01] * 10,
    "最高准确率": [0.1066, 0.0848, 0.0115, 0.0567, 0.1428, 0.1723, 0.018, 0.013, 0.0105, 0.0632],
    "总训练时间(s)": [52726.48, 31466.55, 34199.66, 32928.66, 36327.621, 34655.45, 143538.50, 80446.50, 181203.19, 68611.40],
    "总通信量(MB)": [394320.031, 196159.503, 246450.0196, 1877.0411, 252481.516, 242772.3352, 274655.19, 384174.42, 200547.27, 195674.51],
    "总计算量(FLOPs)": [float(x) for x in [
        213700266514287900,
        213700520182401180,
        213697297243412770,
        211410546884880580,
        211078316242586270,
        211078606464095520,
        887305225873971000,
        357888655153905340,
        44773349954513625000,
        443300494599144770
    ]]
}



df = pd.DataFrame(data_mnist40)

df["ΔAcc"] = df["最高准确率"] - df["初始准确率"]
df["CPE_raw"] = df["ΔAcc"] / df["总通信量(MB)"]
df["TPE_raw"] = df["ΔAcc"] / df["总训练时间(s)"]
df["CoPE_raw"] = df["ΔAcc"] / df["总计算量(FLOPs)"]

def get_bounds(values, margin=0.5):
    logs = np.log10(values)
    min_theory = np.floor(np.min(logs)) - margin
    max_theory = np.ceil(np.max(logs)) + margin
    return min_theory, max_theory

def normalize_log(values, margin=0.5):
    min_theory, max_theory = get_bounds(values, margin)
    print(min_theory,max_theory)
    min_theory = min_theory+0.5
    max_theory = max_theory-0.5
    print(min_theory,max_theory)
    logs = np.log10(values)
    return (logs - min_theory) / (max_theory - min_theory) * 100

def normalize_log2(values, margin=0.5):
    min_theory, max_theory = get_bounds(values, margin)
    print(min_theory,max_theory)
    logs = np.log10(values)
    return (logs - min_theory) / (max_theory - min_theory) * 100

df["CPE_score"] = normalize_log(df["CPE_raw"])
df["TPE_score"] = normalize_log2(df["TPE_raw"])
df["CoPE_score"] = normalize_log2(df["CoPE_raw"])

df["Total_score"] = (
    0.6 * df["CPE_score"] +
    0.25 * df["TPE_score"] +
    0.15 * df["CoPE_score"]
)

df_sorted = df.sort_values(by="Total_score", ascending=False)

print("\n=== 效率评分表（未排序） ===")
print(df[["Method", "CPE_score", "TPE_score", "CoPE_score", "Total_score"]])

print("\n=== 按总分排序 ===")
print(df_sorted[["Method", "Total_score"]])
df_sorted.to_csv("mnist-40.csv", index=False)
